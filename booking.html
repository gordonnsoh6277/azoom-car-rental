<!DOCTYPE html>
<html>

  <head>
    <link rel = "stylesheet" href = "booking.css">
    <title>Book a Car today! | AZoom Car Rentals</title>
  </head>

  <body>
    <ul class = "navbar">
      <li><a href = "index.html">Home</a></li>
      <li><a href = "fleet.html">Fleet</a></li>
      <li><a href = "contact.html">Contact</a></li>
      <li><a href = "about.html">About</a></li>
      <li><a class = "active" href = "#booking">Make a Booking</a></li>
      <li><a style = "display: none;" href = "history.html">Booking History</a></li>
      <li><a style = "display: none;" href = "records.html">Booking Records</a></li>
      <li class = "right"><a id = "loginLink" href = "login.html">Login</a></li>
      <li class = "right"><a id = "logoutButton" style = "display: none;" href = "#" onclick = "confirmLogout ();">Logout</a></li>
      <li class = "right"><a id = "welcomeMessage" style = "display: none;"></a></li>
    </ul>

    <div class = "companyLogo">
        <img src = "img/logo.png" height = "100px" style = "float: left;">
    <h1 style = "text-align: center;">Make a Booking</h1>
    </div>

    <form id = "carBookingForm">
      <label for = "pickupLocation">Pick Up Location:</label>
      <select id = "pickupLocation" name = "pickupLocation" required>
        <option value = "north">Woodlands Checkpoint</option>
        <option value = "west">Tuas Checkpoint</option>
        <option value = "east1">Changi Airport Terminal 1</option>
        <option value = "east2">Changi Airport Terminal 2</option>
        <option value = "east3">Changi Airport Terminal 3</option>
        <option value = "east4">Changi Airport Terminal 4</option>
        <option value = "central">City Centre</option>
      </select>

      <label for = "pickupDate">Pickup Date:</label>
      <input type = "date" id = "pickupDate" name = "pickupDate" required>

      <label for = "dropoffLocation">Drop Off Location:</label>
      <select id = "dropoffLocation" name = "dropoffLocation" required>
        <option value = "north">Woodlands Checkpoint</option>
        <option value = "west">Tuas Checkpoint</option>
        <option value = "east1">Changi Airport Terminal 1</option>
        <option value = "east2">Changi Airport Terminal 2</option>
        <option value = "east3">Changi Airport Terminal 3</option>
        <option value = "east4">Changi Airport Terminal 4</option>
        <option value = "central">City Centre</option>
      </select>

      <label for = "returnDate">Return Date:</label>
      <input type = "date" id = "returnDate" name = "returnDate" required>

      <label for = "carModel">Vehicle Type:</label>
      <select id = "carModel" name = "carModel" required>
        <option value = "" disabled></option>
        <option value = "" disabled>Standard Sedans</option>
        <option data-carid = "camry" data-carmodel = "Toyota Camry" data-image = "img/car/camry.png" data-dailyrate = "39" data-weeklyrate = "249" data-monthlyrate = "699">Toyota Camry</option>
        <option data-carid = "civic" data-carmodel = "Honda Civic" data-image = "img/car/civic.png" data-dailyrate = "49" data-weeklyrate = "299" data-monthlyrate = "799">Honda Civic</option>
        <option data-carid = "lancer" data-carmodel = "Mitsubishi Lancer" data-image = "img/car/lancer.png" data-dailyrate = "29" data-weeklyrate = "199" data-monthlyrate = "549">Mitsubishi Lancer</option>
        <option data-carid = "prius" data-carmodel = "Toyota Prius" data-image = "img/car/prius.png" data-dailyrate = "49" data-weeklyrate = "299" data-monthlyrate = "799">Toyota Prius</option>
        <option value = "" disabled>Standard SUVs</option>
        <option data-carid = "countryman" data-carmodel = "MINI Countryman" data-image = "img/car/countrym.png" data-dailyrate = "49" data-weeklyrate = "259" data-monthlyrate = "799">MINI Countryman</option>
        <option data-carid = "durango" data-carmodel = "Dodge Durango" data-image = "img/car/durango.png" data-dailyrate = "59" data-weeklyrate = "329" data-monthlyrate = "1099">Dodge Durango</option>
        <option data-carid = "edge" data-carmodel = "Ford Edge" data-image = "img/car/edge.png" data-dailyrate = "59" data-weeklyrate = "399" data-monthlyrate = "1299">Ford Edge</option>
        <option data-carid = "suburban" data-carmodel = "Chevrolet Suburban" data-image = "img/car/suburban.png" data-dailyrate = "89" data-weeklyrate = "519" data-monthlyrate = "1699">Chevrolet Suburban</option>
        <option value = "" disabled>Premium Sedans</option>
        <option data-carid = "320t" data-carmodel = "BMW 320i Touring" data-image = "img/car/320t.png" data-dailyrate = "129" data-weeklyrate = "749" data-monthlyrate = "2499">BMW 320i Touring</option>
        <option data-carid = "a3" data-carmodel = "Audi A3" data-image = "img/car/a3.png" data-dailyrate = "109" data-weeklyrate = "699" data-monthlyrate = "2299">Audi A3</option>
        <option data-carid = "models" data-carmodel = "Tesla Model S" data-image = "img/car/models.png" data-dailyrate = "899" data-weeklyrate = "5399" data-monthlyrate = "17999">Tesla Model S</option>
        <option data-carid = "taycan" data-carmodel = "Porsche Taycan" data-image = "img/car/taycan.png" data-dailyrate = "1099" data-weeklyrate = "6599" data-monthlyrate = "22999">Porsche Taycan</option>
        <option value = "" disabled>Premium SUVs</option>
        <option data-carid = "macan" data-carmodel = "Porsche Macan" data-image = "img/car/macan.png" data-dailyrate = "189" data-weeklyrate = "1149" data-monthlyrate = "3799">Porsche Macan</option>
        <option data-carid = "rangerover" data-carmodel = "Land Rover Range Rover" data-image = "img/car/rangerov.png" data-dailyrate = "299" data-weeklyrate = "1799" data-monthlyrate = "5999">Land Rover Range Rover</option>
        <option data-carid = "urus" data-carmodel = "Lamborghini Urus Performante" data-image = "img/car/urus.png" data-dailyrate = "2499" data-weeklyrate = "14999" data-monthlyrate = "49999">Lamborghini Urus Performante</option>
        <option data-carid = "x5m" data-carmodel = "BMW X5 M" data-image = "img/car/x5.png" data-dailyrate = "279" data-weeklyrate = "1649" data-monthlyrate = "5499">BMW X5 M</option>
        <option value = "" disabled>Performance</option>
        <option data-carid = "camaro" data-carmodel = "Chevrolet Camaro" data-image = "img/car/camaro.png" data-dailyrate = "189" data-weeklyrate = "1149" data-monthlyrate = "3799">Chevrolet Camaro</option>
        <option data-carid = "charger" data-carmodel = "Dodge Charger SRT" data-image = "img/car/charger.png" data-dailyrate = "199" data-weeklyrate = "1199" data-monthlyrate = "3999">Dodge Charger SRT</option>
        <option data-carid = "supra" data-carmodel = "Toyota GR Supra" data-image = "img/car/supra.png" data-dailyrate = "189" data-weeklyrate = "1149" data-monthlyrate = "3799">Toyota GR Supra</option>
        <option data-carid = "rcf" data-carmodel = "Lexus RC F" data-image = "img/car/rcf.png" data-dailyrate = "229" data-weeklyrate = "1349" data-monthlyrate = "4499">Lexus RC F</option>
        <option value = "" disabled>High Performance</option>
        <option data-carid = "911c" data-carmodel = "Porsche 911 Carrera S" data-image = "img/car/911c.png" data-dailyrate = "1199" data-weeklyrate = "7199" data-monthlyrate = "23999">Porsche 911 Carrera S</option>
        <option data-carid = "911cab" data-carmodel = "Porsche 911 Carrera S Cabriolet" data-image = "img/car/rcf.png" data-dailyrate = "1299" data-weeklyrate = "7799" data-monthlyrate = "25999">Porsche 911 Carrera S Cabriolet</option>
        <option data-carid = "corvette" data-carmodel = "Chevrolet Corvette" data-image = "img/car/rcf.png" data-dailyrate = "999" data-weeklyrate = "5999" data-monthlyrate = "19999">Chevrolet Corvette</option>
        <option data-carid = "r8" data-carmodel = "Audi R8" data-image = "img/car/r8.png" data-dailyrate = "1799" data-weeklyrate = "10799" data-monthlyrate = "35999">Audi R8</option>

      </select>   

      <button type = "submit">Submit Booking</button>
    </form>

    <div id = "confirmation" style = "display: none;">
      <h2>Booking Confirmation</h2>
      <!-- Display the booking details here -->
      <p>Pickup Location: <strong><span id = "pickupLocationValue"></span></strong></p>
      <p>Pickup Date: <strong><span id = "pickupDateValue"></span></strong></p>
      <p>Drop Off Location: <strong><span id = "dropoffLocationValue"></span></strong></p>
      <p>Return Date: <strong><span id = "returnDateValue"></span></strong></p>
      <p>Vehicle Chosen: <strong><span id = "carModelValue"></span></strong></p>

      <p>Number of Days: <strong><span id = "numberOfDaysValue"></span></strong></p>
      <p>Rental Cost: <strong>$<span id = "rentalCost"></span></strong></p>
      <p id="additionalChargeInfo" style="display: none;">Additional Charge for Different Pickup and Dropoff Location: <strong>$<span id="additionalCharge"></span></strong></p>
      <p>Final Charge (including 8% GST): <strong>$<span id = "finalCharge"></span></strong></p>

      <button id = "confirmBookingButton">Confirm Booking</button>
      <button id = "editBookingButton">Edit Booking</button>
    </div>

    <footer>
      <p>&copy; 2023 AZoom Car Rentals</p>
    </footer>

    <script>
      //define car models and their data
      let carArray = [
        {"id": "camry", "model": "Toyota Camry", "image": "img/car/camry.png", "dailyRate": 39, "weeklyRate": 249, "monthlyRate": 699},
        {"id": "civic", "model": "Honda Civic", "image": "img/car/civic.png", "dailyRate": 49, "weeklyRate": 299, "monthlyRate": 799},
        {"id": "lancer", "model": "Mitsubishi Lancer", "image": "img/car/lancer.png", "dailyRate": 29, "weeklyRate": 199, "monthlyRate": 549},
        {"id": "prius", "model": "Toyota Prius", "image": "img/car/prius.png", "dailyRate": 49, "weeklyRate": 299, "monthlyRate": 799},

        {"id": "countryman", "model": "MINI Countryman", "image": "img/car/countrym.png", "dailyRate": 49, "weeklyRate": 259, "monthlyRate": 799},
        {"id": "durango", "model": "Dodge Durango", "image": "img/car/durango.png", "dailyRate": 59, "weeklyRate": 329, "monthlyRate": 1099},
        {"id": "edge", "model": "Ford Edge", "image": "img/car/edge.png", "dailyRate": 59, "weeklyRate": 399, "monthlyRate": 1299},
        {"id": "suburban", "model": "Chevrolet Suburban", "image": "img/car/suburban.png", "dailyRate": 89, "weeklyRate": 519, "monthlyRate": 1699},

        {"id": "320t", "model": "BMW 320i Touring", "image": "img/car/320t.png", "dailyRate": 129, "weeklyRate": 749, "monthlyRate": 2499},
        {"id": "a3", "model": "Audi A3", "image": "img/car/a3.png", "dailyRate": 109, "weeklyRate": 699, "monthlyRate": 2299},
        {"id": "models", "model": "Tesla Model S", "image": "img/car/edge.png", "dailyRate": 899, "weeklyRate": 5399, "monthlyRate": 17999},
        {"id": "taycan", "model": "Porsche Taycan", "image": "img/car/prius.png", "dailyRate": 1099, "weeklyRate": 6599, "monthlyRate": 22999},

        {"id": "macan", "model": "Porsche Macan", "image": "img/car/macan.png", "dailyRate": 1149, "weeklyRate": 1149, "monthlyRate": 3799},
        {"id": "rangerover", "model": "Land Rover Range Rover", "image": "img/car/rangerov.png", "dailyRate": 299, "weeklyRate": 1799, "monthlyRate": 5999},
        {"id": "urus", "model": "Lamborghini Urus Performante", "image": "img/car/urus.png", "dailyRate": 2499, "weeklyRate": 14999, "monthlyRate": 49999},
        {"id": "x5m", "model": "BMW X5 M", "image": "img/car/x5.png", "dailyRate": 1649, "weeklyRate": 1649, "monthlyRate": 5499},

        {"id": "camaro", "model": "Chevrolet Camaro", "image": "img/car/camaro.png", "dailyRate": 189, "weeklyRate": 1149, "monthlyRate": 3799},
        {"id": "charger", "model": "Dodge Charger SRT", "image": "img/car/charger.png", "dailyRate": 199, "weeklyRate": 1199, "monthlyRate": 3999},
        {"id": "supra", "model": "Toyota GR Supra", "image": "img/car/supra.png", "dailyRate": 189, "weeklyRate": 1149, "monthlyRate": 3799},
        {"id": "rcf", "model": "Lexus RC F", "image": "img/car/rcf.png", "dailyRate": 229, "weeklyRate": 1349, "monthlyRate": 4499},

        {"id": "911c", "model": "Porsche 911 Carrera S", "image": "img/car/911c.png", "dailyRate": 1199, "weeklyRate": 7199, "monthlyRate": 23999},
        {"id": "911cab", "model": "Porsche 911 Carrera S Cabriolet", "image": "img/car/911cab.png", "dailyRate": 1299, "weeklyRate": 7799, "monthlyRate": 25999},
        {"id": "corvette", "model": "Chevrolet Corvette", "image": "img/car/rcf.png", "dailyRate": 999, "weeklyRate": 5999, "monthlyRate": 19999},
        {"id": "r8", "model": "Audi R8", "image": "img/car/r8.png", "dailyRate": 1799, "weeklyRate": 10799, "monthlyRate": 35999},
        ];

      function calculateCost ()
      {
        const pickupDate = new Date (localStorage.getItem ('pickupDate'));
        const returnDate = new Date (localStorage.getItem ('returnDate'));
        const carModel = document.getElementById ('carModel').value;

        //calculate number of rental days
        const numberOfDaysValue = Math.ceil ((returnDate - pickupDate) / (1000 * 60 * 60 * 24));
        var carData;

        carArray.forEach ((car) => {if (car.model == carModel) carData = car;});

        if (carData)
        {
          const dailyRate = carData.dailyRate;
          const weeklyRate = carData.weeklyRate;
          const monthlyRate = carData.monthlyRate;
          let rentalCost;

          if (numberOfDaysValue < 7)
          {
            rentalCost = numberOfDaysValue * dailyRate;
          }
          
          else if (numberOfDaysValue < 30)
          {
            // Calculate the number of full weeks and remaining days
            const fullWeeks = Math.floor (numberOfDaysValue / 7);
            const remainingDays = numberOfDaysValue % 7;
            
            // Calculate the cost using weekly and daily rates
            rentalCost = fullWeeks * weeklyRate + remainingDays * dailyRate;
          }
          
          else
          {
            // Calculate the number of full months and remaining days
            const fullMonths = Math.floor (numberOfDaysValue / 30);
            const remainingDays = numberOfDaysValue % 30;
            
            // Calculate the cost using monthly and daily rates
            rentalCost = fullMonths * monthlyRate + remainingDays * dailyRate;
          }

          return rentalCost;

        }
        
        else
        {
          return 0;
        }
      }
      
      function calculateNumberOfDays (pickupDate, returnDate)
      {
        const oneDay = 24 * 60 * 60 * 1000; //One day in milliseconds
        const startDate = new Date (localStorage.getItem ('pickupDate'));
        const endDate = new Date (localStorage.getItem ('returnDate'));
        const numberOfDays = Math.round ((endDate - startDate) / oneDay);

        return numberOfDays;
      }

      document.getElementById ('carBookingForm').addEventListener ('submit', function (event)
      {
        //process form data and store it in localStorage and then, show the confirmation section and populate the details
        event.preventDefault ();

        //validate form before submitting
        if (!validateForm ())
        {
          return;
        }

        //store data in localStorage
        localStorage.setItem ('pickupLocation', document.getElementById ('pickupLocation').value);
        localStorage.setItem ('pickupDate', document.getElementById ('pickupDate').value);
        localStorage.setItem ('dropoffLocation', document.getElementById ('dropoffLocation').value);
        localStorage.setItem ('returnDate', document.getElementById ('returnDate').value);
        localStorage.setItem ('carModel', document.getElementById ('carModel').value);

        //hide form and display confirmation section
        document.getElementById ('carBookingForm').style.display = 'none';
        document.getElementById ('confirmation').style.display = 'block';

        //populate confirmation section with data using user-friendly values and formatted date
        document.getElementById ('pickupLocationValue').textContent = formatInformation ('pickupLocation', localStorage.getItem ('pickupLocation'));
        document.getElementById ('pickupDateValue').textContent = formatDate (localStorage.getItem ('pickupDate'));
        document.getElementById ('dropoffLocationValue').textContent = formatInformation ('dropoffLocation', localStorage.getItem ('dropoffLocation'));
        document.getElementById ('returnDateValue').textContent = formatDate (localStorage.getItem ('returnDate'));
        document.getElementById ('carModelValue').textContent = formatInformation ('carModel', localStorage.getItem ('carModel'));

        //calculate and display number of days, rental cost, and final charge
        const pickupDate = localStorage.getItem ('pickupDate');
        const returnDate = localStorage.getItem ('returnDate');
        // Get the pickup and dropoff locations from localStorage
        const pickupLocation = localStorage.getItem ('pickupLocation');
        const dropoffLocation = localStorage.getItem ('dropoffLocation');

        const numberOfDaysValue = calculateNumberOfDays (pickupDate, returnDate);
        const rentalCost = calculateCost ();
        const gst = rentalCost * 0.08;
        // Calculate the additional charge if locations are different
        const additionalCharge = pickupLocation !== dropoffLocation ? 40 : 0;

        // Display the additional charge in the confirmation section only when it's needed
        const additionalChargeInfo = document.getElementById ('additionalChargeInfo');
        const additionalChargeSpan = document.getElementById ('additionalCharge');
        if (additionalCharge === 0)
        {
          additionalChargeInfo.style.display = 'none';
        }
        
        else
        {
          additionalChargeInfo.style.display = 'block';
          additionalChargeSpan.textContent = additionalCharge.toFixed(2);
        }

        // Calculate and display the final charge (including the additional charge)
        const finalCharge = rentalCost + gst + additionalCharge;
        document.getElementById('finalCharge').textContent = finalCharge.toFixed(2);
        document.getElementById ('numberOfDaysValue').textContent = numberOfDaysValue;
        document.getElementById ('rentalCost').textContent = rentalCost.toFixed (2);
        document.getElementById ('finalCharge').textContent = finalCharge.toFixed (2);
      });

      //handle "Confirm Booking" button
      document.getElementById ('confirmBookingButton').addEventListener ('click', function ()
      {
        window.location.href = 'payment.html';
      });

      //handle "Edit Booking" button
      document.getElementById ('editBookingButton').addEventListener ('click', function ()
      {
        //Hide the confirmation section and show the form for editing
        document.getElementById ('carBookingForm').style.display = 'block';
        document.getElementById ('confirmation').style.display = 'none';
      });

      //validate date
      function validateForm ()
      {
        const pickupDate = new Date (document.getElementById ('pickupDate').value);
        const returnDate = new Date (document.getElementById ('returnDate').value);
        const currentDate = new Date ();

        if (pickupDate < currentDate)
        {
          alert ('Pickup date cannot be a date that has already passed.');
          return false;
        }

        if (returnDate < pickupDate)
        {
          alert ('Return date cannot be earlier than or on the same day as the pickup date.');
          return false;
        }

        return true;
      }

      function formatInformation (elementId, value)
      {
        var element = document.getElementById (elementId);
        if (element)
        {
          var options = element.options;
          for (var i = 0; i < options.length; i++)
          {
            if (options[i].value === value)
            {
              return options[i].text;
            }
          }
        }

        return value; //Return the original value if not found in the dropdown
      }

      function formatDate (dateString)
      {
        const options = {year: 'numeric', month: '2-digit', day: '2-digit' };

        return new Date (dateString).toLocaleDateString (undefined, options);
      }

      //upon page load, checks if user is logged in and display welcome message + logout button if they are
      document.addEventListener ('DOMContentLoaded', function ()
      {
        //check if user is logged in, and set initial state
        var loggedIn = localStorage.getItem ('loggedIn');
        var userRole = localStorage.getItem ('userRole');

        if (loggedIn === 'true')
        {
          if (userRole === 'customer')
          {
            //show "booking.html" and "history.html" link for customers
            //document.querySelector ('a[href = "booking.html"]').style.display = 'block';
            document.querySelector ('a[href = "history.html"]').style.display = 'block';
          }
          
          else if (userRole === 'employee')
          {
            //show "records.html" link for employees
            document.querySelector ('a[href = "records.html"]').style.display = 'block';
          }

          //hide login link and show welcome message and logout button
          var loginLink = document.getElementById ('loginLink');
          var welcomeMessage = document.getElementById ('welcomeMessage');
          var logoutButton = document.getElementById ('logoutButton');

          if (loginLink) loginLink.style.display = 'none';
          if (welcomeMessage)
          {
            welcomeMessage.style.display = 'block';
            welcomeMessage.textContent = 'Welcome ' + localStorage.getItem ('username');
          }

          if (logoutButton) logoutButton.style.display = 'block';
        }
      });

      //logs user out and clears the data from local storage
      function confirmLogout ()
      {
        var confirmLogout = window.confirm ('Are you sure you want to log out?');
        if (confirmLogout)
        {
          //remove user information from local storage
          localStorage.removeItem ('loggedIn');
          localStorage.removeItem ('username');
          localStorage.removeItem ('userRole')

          var loginLink = document.getElementById ('loginLink');
          var welcomeMessage = document.getElementById ('welcomeMessage');
          var logoutButton = document.getElementById ('logoutButton');
          var bookingPage = document.querySelector ('a[href = "booking.html"]');
          var historyPage = document.querySelector ('a[href = "history.html"]');
          var recordsPage = document.querySelector ('a[href = "records.html"]');

          if (loginLink) loginLink.style.display = 'block';
          if (welcomeMessage) welcomeMessage.style.display = 'none';
          if (logoutButton) logoutButton.style.display = 'none';
          if (bookingPage) bookingPage.style.display = 'none';
          if (historyPage) historyPage.style.display = 'none';
          if (recordsPage) recordsPage.style.display = 'none';

        }

        // Redirect the user to index.html
        window.location.href = 'index.html';
      }
    </script>

  </body>

</html>